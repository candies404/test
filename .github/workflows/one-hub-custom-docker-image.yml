name: 检测镜像架构类型

on:
  workflow_dispatch:

jobs:
  check-architectures:
    runs-on: ubuntu-latest  # 使用 Ubuntu 最新版本作为运行环境

    steps:
    - name: 安装 skopeo
      run: |
        sudo apt-get update
        sudo apt-get install -y skopeo  # 安装 skopeo 工具

    - name: 检测镜像架构
      run: |
        # 定义需要检测的镜像列表
        IMAGES=("nginx" "redis:7.0" "chipsman/uptime-kuma")

        for IMAGE in "${IMAGES[@]}"; do
          echo "正在检测镜像: $IMAGE"
          OUTPUT=$(skopeo inspect --raw docker://$IMAGE)  # 获取镜像元数据

          if echo "$OUTPUT" | grep -q '"manifests":'; then
            echo "$IMAGE 是多架构镜像"
          else
            echo "$IMAGE 是单架构镜像"
          fi
          echo "----------------------------------------"
        done
